# Windows 작업 스케줄러 설정 가이드

## 1. 준비 사항

- Python 경로: `C:\Program Files\Python311\python.exe`
- 실행 스크립트: `batch_collect.py`
- 작업 디렉토리: `D:\Gomguard\program\samsung_crawl\youtube_brand_analyzer`

## 2. Windows 작업 스케줄러 설정 방법

### 2-1. 작업 스케줄러 열기

1. **시작 메뉴** → **작업 스케줄러** 검색 및 실행
   - 또는 `Win + R` → `taskschd.msc` 입력 → 확인

### 2-2. 새 작업 만들기

1. 오른쪽 패널에서 **"기본 작업 만들기"** 클릭

2. **이름 및 설명 입력**
   - 이름: `YouTube Batch Data Collection`
   - 설명: `YouTube 브랜드 분석 데이터 자동 수집`

3. **트리거 설정** (실행 주기 선택)
   - **매일**: 매일 특정 시간에 실행
   - **매주**: 주 단위로 실행
   - **한 번**: 특정 날짜/시간에 한 번만 실행

   **권장 설정**: 매일 또는 매주
   - 시작 날짜/시간 설정
   - 예: 매일 오전 2시 (서버 부하가 적은 시간)

4. **동작 설정**
   - **"프로그램 시작"** 선택
   - **프로그램/스크립트**:
     ```
     C:\Program Files\Python311\python.exe
     ```
   - **인수 추가(옵션)**:
     ```
     batch_collect.py
     ```
   - **시작 위치(옵션)**:
     ```
     D:\Gomguard\program\samsung_crawl\youtube_brand_analyzer
     ```

   > **중요**: "시작 위치"를 반드시 설정해야 Python 스크립트가 올바른 디렉토리에서 실행됩니다.

5. **완료**
   - 요약 내용 확인 후 **완료** 클릭

### 2-3. 고급 설정 (선택 사항)

작업을 더블클릭하여 추가 설정:

1. **일반 탭**
   - ✅ "가장 높은 수준의 권한으로 실행" (선택)
   - 보안 옵션: "사용자의 로그온 여부에 관계없이 실행" (백그라운드 실행)

2. **트리거 탭**
   - 트리거 편집하여 세부 조정 가능
   - 고급 설정:
     - ✅ "작업 반복 간격" (예: 12시간마다)
     - 기간: 무기한

3. **조건 탭**
   - ⬜ "컴퓨터의 AC 전원이 켜진 경우에만 작업 시작" (선택 해제 권장)
   - ✅ "컴퓨터를 깨워서 이 작업 실행" (선택)

4. **설정 탭**
   - ✅ "요청 시 작업 실행 허용" (선택)
   - ✅ "작업이 실패하면 다음 일정에 따라 다시 시작" (선택)
     - 다시 시도 간격: 1분
     - 재시도 횟수: 3회

## 3. 수동 테스트

스케줄러 설정 후 즉시 테스트:

1. 작업 스케줄러에서 방금 만든 작업 찾기
2. 작업 우클릭 → **"실행"** 선택
3. 작업 스케줄러 라이브러리에서 **마지막 실행 결과** 확인
   - `0x0`: 성공
   - 다른 값: 실패 (아래 문제 해결 참조)

## 4. 로그 확인 방법

### 로그 파일 위치
batch_collect.py는 콘솔에 로그를 출력하지만, 작업 스케줄러에서 실행 시 콘솔 출력이 보이지 않습니다.

**로그를 파일로 저장하려면** 동작 설정 수정:
- **인수 추가**:
  ```
  batch_collect.py > batch_collect_scheduled.log 2>&1
  ```

이렇게 하면 `batch_collect_scheduled.log` 파일에 로그가 저장됩니다.

### 로그 내용
- 처리된 키워드 목록
- 수집된 비디오 및 댓글 수
- 데이터베이스 저장 상태
- 에러 발생 시 상세 내용

## 5. 권장 스케줄

### 옵션 1: 매일 수집
- **시간**: 오전 2:00 (서버 부하 적은 시간)
- **장점**: 최신 데이터 유지
- **단점**: API 할당량 사용 많음

### 옵션 2: 주 2회 수집
- **요일/시간**: 월요일, 목요일 오전 2:00
- **장점**: API 할당량 절약하면서 주기적 데이터 수집
- **단점**: 실시간성 낮음

### 옵션 3: 매주 수집
- **요일/시간**: 매주 월요일 오전 2:00
- **장점**: API 할당량 최소 사용
- **단점**: 주간 변화 추적 어려움

## 6. 문제 해결

### 작업이 실행되지 않을 때
1. **작업 스케줄러 라이브러리**에서 작업 상태 확인
2. **마지막 실행 결과** 열 확인
   - `0x0`: 성공
   - `0x1`: 실패 (로그 확인 필요)

### 권한 문제
- 관리자 권한으로 실행 필요 시:
  - 작업 속성 → 일반 탭 → "가장 높은 수준의 권한으로 실행" 체크

### Python 경로 오류
- Python 경로가 다른 경우:
  ```bash
  where python
  ```
  명령으로 Python 경로 확인 후, 작업 스케줄러의 "프로그램/스크립트"에 해당 경로 입력

### 작업 디렉토리 문제
- **"시작 위치"를 반드시 설정**해야 합니다:
  ```
  D:\Gomguard\program\samsung_crawl\youtube_brand_analyzer
  ```
- 설정하지 않으면 상대 경로로 된 파일들을 찾지 못할 수 있습니다.

## 7. 모니터링

### 작업 실행 이력 확인
1. 작업 스케줄러에서 작업 선택
2. 하단 **"기록"** 탭 클릭
3. 실행/완료/오류 이벤트 확인

### 이메일 알림 설정 (선택)
1. 작업 속성 → 동작 탭
2. **새로 만들기** → **전자 메일 보내기** (Windows Server만 지원)
3. 대안: Python 스크립트에서 직접 이메일 전송 코드 추가

## 8. 추가 팁

### API 할당량 관리
- YouTube API 할당량: 10,000 units/day
- 비디오 검색: 100 units/request
- 하루에 약 100개 검색 가능
- 스케줄 간격을 적절히 조정하여 할당량 관리

### 로그 정리
- 오래된 로그 파일은 주기적으로 삭제 또는 아카이브
- 또는 로그 로테이션 스크립트 추가

### 백업
- 데이터베이스 정기 백업 권장
- PostgreSQL pg_dump 사용 고려
